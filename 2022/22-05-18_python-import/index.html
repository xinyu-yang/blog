<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Python relative import 深入理解 - 麋鹿博客 (Elk blog) | 一个分享知识和乐趣的地方</title><meta name=description content="本文详细记录了本人在使用 python import 时遇到的问题以及解决方案"><meta property="og:title" content="Python relative import 深入理解"><meta property="og:description" content="本文详细记录了本人在使用 python import 时遇到的问题以及解决方案"><meta property="og:type" content="article"><meta property="og:url" content="https://xinyu-yang.github.io/blog/2022/22-05-18_python-import/"><meta property="og:image" content="https://xinyu-yang.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-18T22:05:01+08:00"><meta property="article:modified_time" content="2022-05-20T11:32:13+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://xinyu-yang.github.io/logo.png"><meta name=twitter:title content="Python relative import 深入理解"><meta name=twitter:description content="本文详细记录了本人在使用 python import 时遇到的问题以及解决方案"><meta name=application-name content="麋鹿博客"><meta name=apple-mobile-web-app-title content="麋鹿博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://xinyu-yang.github.io/blog/2022/22-05-18_python-import/><link rel=prev href=https://xinyu-yang.github.io/blog/2022/22-02-08_zotero-config/><link rel=next href=https://xinyu-yang.github.io/blog/2022/22-11-24_zotero-config/><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/blog/css/style.min.457b41f3877ae4698fed78d872da4da64fa4f2b3d27162707df2dcb9141a227f.css integrity="sha256-RXtB84d65GmP7XjYctpNpk+k8rPScWJwffLcuRQaIn8="><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Python relative import 深入理解","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/xinyu-yang.github.io\/blog\/2022\/22-05-18_python-import\/"},"image":["https:\/\/xinyu-yang.github.io\/blog\/images\/avatar.png"],"genre":"posts","keywords":"python","wordcount":2679,"url":"https:\/\/xinyu-yang.github.io\/blog\/2022\/22-05-18_python-import\/","datePublished":"2022-05-18T22:05:01+08:00","dateModified":"2022-05-20T11:32:13+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Xinyu Yang","logo":"https:\/\/xinyu-yang.github.io\/blog\/images\/avatar.png"},"author":{"@type":"Person","name":"Xinyu Yang"},"description":"本文详细记录了本人在使用 python import 时遇到的问题以及解决方案"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/blog/ title="麋鹿博客 (Elk blog) | 一个分享知识和乐趣的地方"><img class="lazyload logo" src=/blog/svg/loading.min.svg data-src=/blog/images/avatar.png data-srcset="/blog/images/avatar.png, /blog/images/avatar.png 1.5x, /blog/images/avatar.png 2x" data-sizes=auto alt=/blog/images/avatar.png title=/blog/images/avatar.png>麋鹿博客</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/posts/ title=文章列表>文章 </a><a class=menu-item href=/blog/categories/>分类 </a><a class=menu-item href=/blog/tags/>标签 </a><a class=menu-item href=/blog/about/>关于 </a><a class=menu-item href=https://github.com/xinyu-yang/blog title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/blog/2022/22-05-18_python-import/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title="麋鹿博客 (Elk blog) | 一个分享知识和乐趣的地方"><img class="lazyload logo" src=/blog/svg/loading.min.svg data-src=/blog/images/avatar.png data-srcset="/blog/images/avatar.png, /blog/images/avatar.png 1.5x, /blog/images/avatar.png 2x" data-sizes=auto alt=/blog/images/avatar.png title=/blog/images/avatar.png>麋鹿博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/blog/posts/ title=文章列表>文章</a><a class=menu-item href=/blog/categories/ title>分类</a><a class=menu-item href=/blog/tags/ title>标签</a><a class=menu-item href=/blog/about/ title>关于</a><a class=menu-item href=https://github.com/xinyu-yang/blog title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value"><option value=/blog/2022/22-05-18_python-import/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Python relative import 深入理解</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://xinyu-yang.github.io title=Author target=_blank rel="noopener noreferrer author" class=author><i class="fas fa-user-circle fa-fw"></i>Xinyu Yang</a></span>&nbsp;<span class=post-category>收录于 <a href=/blog/categories/record/><i class="far fa-folder fa-fw"></i>record</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-05-18>2022-05-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2679 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<i class="fas fa-eye fa-fw"></i>&nbsp;
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/blog/img/spinner.svg alt=spinner.svg></span> 次阅读 </span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#从-modulenotfounderror-说起>从 <code>ModuleNotFoundError</code> 说起</a></li><li><a href=#相对导入-relative-import>相对导入 Relative Import</a></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class=content id=content><p>随着程序的复杂，会逐渐将不同的功能放置在不同的文件中。项目也从简单脚本的单一文件转变为更加复杂的文件结构，这就涉及到不同文件的导入问题。</p><p>以前写的程序都比较简单，即使有多个文件，但也是单层次的扁平结构，操作起来也比较简单，尝试一下就可以正确导入。</p><p>但是当文件有了更复杂的层次之后，发现文件导入并没有自己想象的那么简单。每次都是盲人摸象般的盲目尝试，直到程序不会报错。靠着这种开盲盒般的操作方式，即使最后得出正确结果，也不知道怎么回事。</p><p>也看过一些关于文件导入的文章，但一是没有自己的实际操作；二是很多文章讲的比较肤浅，不涉及本质；甚至有的文章还会给读者错误的导向，害人不浅（这一点后面会说）。</p><h2 id=从-modulenotfounderror-说起>从 <code>ModuleNotFoundError</code> 说起</h2><p>一般报该错误，常见的有两个原因：</p><ol><li>如果是第三方包，那么是相应的模块没有安装，直接 <code>pip install *</code> 安装即可。</li><li>如果自己写的程序，那么就是包导入的路径不对。本文主要关注的也是该问题。</li></ol><p>如上所述，如果是第二种情况，即包导入的位置不对。那么我们就应该添加包的查询位置，<code>sys.path</code> 就是用来指定包查找位置的列表。</p><p>下面将以下述文件结构举例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>src
</span></span><span class=line><span class=cl>	├── foo
</span></span><span class=line><span class=cl>	│   ├── foo.py
</span></span><span class=line><span class=cl>	│   ├── bar.py
</span></span><span class=line><span class=cl>	│   ├── __init__.py
</span></span><span class=line><span class=cl>	├── hello.py
</span></span><span class=line><span class=cl>	├── main.py
</span></span></code></pre></td></tr></table></div></div><p>这里 <code>hello.py</code> 中的代码为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>helloworld</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;hello world&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>bar.py</code>中的代码为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>bar</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;This is in bar&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>接下来试图从<code>foo.py</code> 中导入该函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hello</span><span class=o>.</span><span class=n>helloworld</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>该程序理所当然报 <code>ModuleNotFoundError</code>，这是因为包的位置没有被添加到导入路径中，前面也提到，<code>sys.path</code>其实是一个列表，所以我们只需将需要的路径添加到该列表中即可。接下来修改代码如下（很多博客中写的都是此方法）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;..&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hello</span><span class=o>.</span><span class=n>helloworld</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>如果我们在路径 <code>foo</code> 下运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ python foo.py
</span></span></code></pre></td></tr></table></div></div><p>那么程序可以顺利执行。<strong>但是</strong>如果我们在程序根目录下执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ python ./foo/foo.py
</span></span></code></pre></td></tr></table></div></div><p>那么依然会报 <code>ModuleNotFoundError</code> 。经过分析，发现这是因为我们在添加文件路径到 <code>sys.path</code> 的时候，加入的只是相对路径。</p><p>而相对路径是相对于现在的执行路径而言的，当前的执行目录为根目录，根目录的上一层当然没有要找的 <code>hello</code>模块，所以程序当然报错。</p><p>所以合理的方式是直接导入绝对路径，那么无论在哪里运行，都是可以找到相应的模块的，具体代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl>import sys, os
</span></span><span class=line><span class=cl>sys.path.append<span class=o>(</span>os.path.join<span class=o>(</span>sys.path<span class=o>[</span>0<span class=o>]</span>, <span class=s2>&#34;..&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>import hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>hello.helloworld<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><p>其中<code>sys.path[0]</code>通过阅读<a href=https://docs.python.org/3/library/sys.html target=_blank rel="noopener noreferrer">官方文档</a>可以得知，其代表启动 Python 解释器的脚本的目录路径。</p><p>这里就把文件的绝对路径以相对路径（<code>".."</code>）的方式添加到了查找列表中。添加后的 <code>sys.path</code> 如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span><span class=s1>&#39;**/src/foo&#39;</span>, <span class=s1>&#39;/usr/local/lib/python38.zip&#39;</span>, <span class=s1>&#39;/usr/local/lib/python3.8&#39;</span>, <span class=s1>&#39;/usr/local/lib/python3.8/lib-dynload&#39;</span>, <span class=s1>&#39;/home/yang/ML/py4flink/lib/python3.8/site-packages&#39;</span>, <span class=s1>&#39;**/src/foo/..&#39;</span><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=相对导入-relative-import>相对导入 Relative Import</h2><p>按照上述方式可以将模块整个导入，但是有时候我们并不想直接导入整个包，而只想导入包的一部分，比如 <code>hello.py</code>文件下 <code>helloworld</code> 函数。那么我们那么尝试着只导入该函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;..&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hello</span> <span class=kn>import</span> <span class=n>helloworld</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>helloworld</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>通过测试发现，不管是在根目录还是在 <code>foo</code>目录下都可以正常运行。</p><p>接下来我们尝试着从<code>bar.py</code>中导入<code>bar</code> 函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bar</span> <span class=kn>import</span> <span class=n>bar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bar</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>同样，不管从根目录还是从 <code>foo</code> 目录下运行 <code>foo.py</code>都是没有问题的。</p><p>此时我们尝试另外一种操作，假设在根目录下的 <code>main.py</code> 文件中需要调用 <code>foo.py</code>中的某个函数 <code>foo</code> ，其代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;..&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bar</span> <span class=kn>import</span> <span class=n>bar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>foo</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>bar</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;This is in foo&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这是一个很常见的操作，我们需要在 <code>main</code>文件下调用包里的某个文件，然后包里的文件又是相互调用的关系。然后我们尝试在 <code>main</code> 文件中导入该函数，代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># main.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>foo</span> <span class=kn>import</span> <span class=n>foo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>foo</span><span class=o>.</span><span class=n>foo</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>然后程序居然会报如下错误：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> File <span class=s2>&#34;**src/foo/foo.py&#34;</span>, line 6, in foo
</span></span><span class=line><span class=cl>    from bar import bar
</span></span><span class=line><span class=cl>ModuleNotFoundError: No module named <span class=s1>&#39;bar&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>这是为什么呢？按理说 <code>foo.py</code>和 <code>bar.py</code>同属一个目录，直接从本目录下导入应该没有问题吧，为解决该问题，我们先打印出一些信息，在<code>foo.py</code>中添加一些调试代码，同时将导入<code>bar</code>的操作后移：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># foo.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;..&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>foo</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;This is in foo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=vm>__name__</span><span class=si>}</span><span class=s1>, __file__: </span><span class=si>{</span><span class=vm>__file__</span><span class=si>}</span><span class=s1>, __package__: </span><span class=si>{</span><span class=nb>repr</span><span class=p>(</span><span class=n>__package__</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>bar</span> <span class=kn>import</span> <span class=n>bar</span>
</span></span><span class=line><span class=cl>    <span class=n>bar</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>再次执行 <code>main</code> 程序，在报错之前，打印出如下结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span><span class=s1>&#39;**/src&#39;</span>, <span class=s1>&#39;/usr/local/lib/python38.zip&#39;</span>, <span class=s1>&#39;/usr/local/lib/python3.8&#39;</span>, <span class=s1>&#39;/usr/local/lib/python3.8/lib-dynload&#39;</span>, <span class=s1>&#39;/home/yang/ML/py4flink/lib/python3.8/site-packages&#39;</span>, <span class=s1>&#39;**/src/..&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>__main__, __file__: **/src/foo/foo.py, __package__: <span class=s1>&#39;foo&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>发现导入文件的路径变成了根目录，所以无法找到<code>bar</code>文件的路径了。为了验证该猜想，我们手动在<code>main</code>文件中把<code>bar</code>文件的导入路径加上：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># main.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;foo&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>foo</span> <span class=kn>import</span> <span class=n>foo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>foo</span><span class=o>.</span><span class=n>foo</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>运行 <code>main</code> 程序，顺利执行！</p><p>但是在写程序的时候，我们不可能像这样把所有包中的文件绝对引用路径全都加上。我们还是希望不管被哪个程序导入，包里所有文件的相对引用位置是不变的。</p><p>通过阅读官方文档得知，我们可以采用包相对导入来解决这个问题。相对导入的形式类似于<code>bash</code>中的相对路径，通过在包前面加<code>.</code>来表示相对位置，一个代表本目录，两个代表上级目录，三个代表。。。</p><p>根据该方案，我们将 <code>foo.py</code>中的导入操作修改如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.bar</span> <span class=kn>import</span> <span class=n>bar</span>
</span></span></code></pre></td></tr></table></div></div><p>再次运行 <code>main</code> 程序，顺利执行！</p><p>此时好像一切都没有问题了，然后我们尝试着再次执行 <code>foo.py</code> ，发现居然又报错了，这次错误变成了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>File <span class=s2>&#34;foo/foo.py&#34;</span>, line 8, in foo
</span></span><span class=line><span class=cl>    from .bar import bar
</span></span><span class=line><span class=cl>ImportError: attempted relative import with no known parent package
</span></span></code></pre></td></tr></table></div></div><p>加上一个点之后居然就导入不了了！经过网上搜索，找到了一些解决方案【<a href=https://stackoverflow.com/a/28154841 target=_blank rel="noopener noreferrer">1</a>】【<a href=https://iq-inc.com/importerror-attempted-relative-import/ target=_blank rel="noopener noreferrer">2</a>】。</p><p>但是还是不太懂根本原因，后来看了<a href=https://docs.python.org/3/reference/import.html target=_blank rel="noopener noreferrer">官方文档</a>和<a href=https://stackoverflow.com/a/21233334 target=_blank rel="noopener noreferrer">该回答</a>中关于<code>__package__</code>变量的解释，我才大概搞明白是怎么回事。其中一些重要的摘录如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>__package__:
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>This attribute is used instead of __name__ to calculate explicit relative imports for main modules, as defined in PEP 366. It is expected to have the same value as __spec__.parent.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Changed in version 3.6: The value of __package__ is expected to be the same as __spec__.parent.
</span></span></code></pre></td></tr></table></div></div><p>大概意思就是该变量用于计算相对导入的位置，并且该变量的值必须和<code>__spec__.parent</code>的值相同。</p><p>根据上文可知，当我们执行<code>main.py</code>的时候，我们所打印出的<code>__package__</code>值为<code>'foo'</code> 而当我们单独执行 <code>foo.py</code>的时候，其打印出的值为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>__main__, __file__: foo/foo.py, __package__: None
</span></span></code></pre></td></tr></table></div></div><p>所以我认为根本的原因是：当单独执行<code>foo.py</code>的时候，其所在目录下的文件并不被当作 python module，而只是被当成是普通的脚本进行执行。因此相应的<code>__package__</code>值为<code>None</code> ，进而进行relative import的时候，因不满足上述条件，所以报错。</p><p>而当从<code>main.py</code>中导入的时候，<code>foo.py</code>目录中的文件都被当成是<code>foo</code>包的一部分，所以可以使用relative import导入成功。</p><p>那么能不能以模块的方式运行<code>foo.py</code>呢？答案是可以的，只需要在执行的时候加上<code>-m</code>选项，比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ python -m foo.foo
</span></span></code></pre></td></tr></table></div></div><p>那么<code>foo.py</code>就会被当成一个模块来执行。同时我还从<a href=https://stackoverflow.com/a/28151907 target=_blank rel="noopener noreferrer">该回答</a>中学到一种方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>if</span> <span class=nv>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span>:
</span></span><span class=line><span class=cl>    from bar import bar
</span></span><span class=line><span class=cl><span class=k>else</span>:
</span></span><span class=line><span class=cl>    from .bar import bar
</span></span></code></pre></td></tr></table></div></div><p>这样就可以避免出错了。</p><p>至此，大功告成！</p><h2 id=总结>总结</h2><p>最后说些总结：</p><ol><li>参考<a href=https://iq-inc.com/importerror-attempted-relative-import/ target=_blank rel="noopener noreferrer">该文</a>，除<code>main.py</code>等少数包之外，尽量将所有被调用的文件组织成包的形式。</li><li>尽量采用<code>import</code>直接导入本地文件，而不是<code>from * import *</code></li><li>如果一定要使用<code>from * import *</code>，对于相同路径下的文件，一定要根据是否封装为模块选择合适的导入方式，或者是像上述所说，加上一个判断。</li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-05-20&nbsp;<a class=git-hash href=https://github.com/xinyu-yang/blog/commit/b97b4357b87bdf9016b1a75ba5f68371e61d0403 target=_blank rel="noopener noreferrer" title="commit by yxy.gram(yangxinyu75@live.com) b97b4357b87bdf9016b1a75ba5f68371e61d0403: update python import">
<i class="fas fa-hashtag fa-fw"></i>b97b435</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/blog/2022/22-05-18_python-import/index.md target=_blank rel="noopener noreferrer">阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://xinyu-yang.github.io/blog/2022/22-05-18_python-import/ data-title="Python relative import 深入理解" data-via=xinyuyang18 data-hashtags=python><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://xinyu-yang.github.io/blog/2022/22-05-18_python-import/ data-hashtag=python><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://xinyu-yang.github.io/blog/2022/22-05-18_python-import/ data-title="Python relative import 深入理解"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://xinyu-yang.github.io/blog/2022/22-05-18_python-import/ data-title="Python relative import 深入理解"><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/blog/tags/python/>python</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/2022/22-02-08_zotero-config/ class=prev rel=prev title="Zotero 配置记录（一：OneDrive 软链接）"><i class="fas fa-angle-left fa-fw"></i>Zotero 配置记录（一：OneDrive 软链接）</a>
<a href=/blog/2022/22-11-24_zotero-config/ class=next rel=next title="Zotero 配置记录（二：坚果云 WebDAV）">Zotero 配置记录（二：坚果云 WebDAV）<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=tcomment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://twikoo.js.org/>Twikoo</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=busuanzi_container_site_pv>本站总访问量 <span id=busuanzi_value_site_pv><img src=/blog/img/spinner.svg alt=spinner.svg></span> 次</span>
<span class=division>•</span>
<span id=busuanzi_container_site_uv>本站总访客数 <span id=busuanzi_value_site_uv><img src=/blog/img/spinner.svg alt=spinner.svg></span> 人</span></div><div class=footer-line><a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.110.0">Hugo</a> - <a href=https://github.com/xinyu-yang/EnjoyIt target=_blank rel="noopener noreferrer" title="EnjoyIt 0.0.1"><i class="fas fa-heart fa-fw"></i>EnjoyIt</a><span class=division> •</span>
<i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://xinyu-yang.github.io target=_blank rel="noopener noreferrer">Xinyu Yang</a></span>&nbsp;•&nbsp;<span class=license><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twikoo@1.4.15/dist/twikoo.all.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=/blog/lib/lunr/lunr.stemmer.support.min.8127f0ca4cabc7246f3620f3ef3bf9b1db02805dfe03d6d4c57bc74bc0bf6eea.js integrity="sha256-gSfwykyrxyRvNiDz7zv5sdsCgF3+A9bUxXvHS8C/buo="></script><script type=text/javascript src=/blog/lib/lunr/lunr.multi.min.5746f79fe1d78782987dc8168accfb7cf0c9f488651e4e4d56a6472329231b69.js integrity="sha256-V0b3n+HXh4KYfcgWisz7fPDJ9IhlHk5NVqZHIykjG2k="></script><script type=text/javascript src=/blog/lib/lunr/lunr.zh.min.df40c83b86d7cea2122cd35d56db3e6e4bc34b09a62755f0f3c48b5e9c66a8a4.js integrity="sha256-30DIO4bXzqISLNNdVts+bkvDSwmmJ1Xw88SLXpxmqKQ="></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{twikoo:{el:"#tcomment",envId:"https://twikoo-comment-xinyu-yang.vercel.app/"}},search:{highlightTag:"em",lunrIndexURL:"/blog/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/blog/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/blog/js/theme.a63aa926c3cd8d6695367caa381f19bdaa78efc1bd87b33c0a4968ca187b5c7f.js integrity="sha256-pjqpJsPNjWaVNnyqOB8Zvap478G9h7M8Ckloyhh7XH8="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NSNR248K3V")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-NSNR248K3V" async></script><script id=baidu_analytics type=text/javascript>var _hmt=_hmt||[];(function(){if(window.location.hostname==="localhost")return;var t,e=document.createElement("script");e.async=!0,e.src="https://hm.baidu.com/hm.js?b72cf2095ce01c4c9d6392678286aafd",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>